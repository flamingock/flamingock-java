id: per-operation-rollback-change
transactional: false
template: MongoChangeTemplate
targetSystem:
  id: "mongodb"
apply:
  operations:
    - type: createCollection
      collection: orders
      rollback:
        type: dropCollection
        collection: orders

    - type: insert
      collection: orders
      parameters:
        documents:
          - orderId: "ORD-001"
            customer: "John Doe"
            total: 150.00
          - orderId: "ORD-002"
            customer: "Jane Smith"
            total: 250.00
      rollback:
        type: delete
        collection: orders
        parameters:
          filter: {}

    - type: createIndex
      collection: orders
      parameters:
        keys:
          orderId: 1
        options:
          name: "orderId_index"
          unique: true
      rollback:
        type: dropIndex
        collection: orders
        parameters:
          indexName: "orderId_index"
